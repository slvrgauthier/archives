<!--
/* Fichier permettant l'enregistrement des messages dans la base de données.
 * 
 * @author: GAUTHIER Silvère.
 * @update: 10-04 14:19
 * @last_update_author : GAUTHIER Silvère
 */
-->
<?php
// Connexion à la base de données
require_once("connexion_db.php");

// Récupération des messages
$req = $bdd->prepare('SELECT nom,prenom,DATE_FORMAT(date_envoi, "%d/%m/%Y à %Hh%i") AS date_envoi,message FROM chat_message,utilisateur WHERE id_source=id_user AND id_conversation=? ORDER BY id_message');
$req->execute(array($_POST['id_conversation']));
 
// Affichage de chaque message (toutes les données sont protégées par htmlspecialchars)
while ($data = $req->fetch())
{
    echo '<p><i><strong class="msg_left" >'.htmlspecialchars($data['nom'], ENT_QUOTES|ENT_SUBSTITUTE).' '.htmlspecialchars($data['prenom'], ENT_QUOTES|ENT_SUBSTITUTE).'</strong> a dit :<small class="msg_right" >Le '.htmlspecialchars($data['date_envoi'], ENT_QUOTES|ENT_SUBSTITUTE).'</i></small><br/><dd>'.htmlspecialchars($data['message'], ENT_QUOTES|ENT_SUBSTITUTE).'</dd></p>';
}

$req->closeCursor();
?>