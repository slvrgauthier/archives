<?php
/**
 * Vue principale pour le chat
 *
 * @author Gauthier Silvère <slvrgauthier@gmail.com>
 * @update: 21-04-2013 10:53
 * @last_update_author : GAUTHIER Silvère
 *
 * Génération de la liste de contact : LECERF Geoffrey
 */
 
if(isset($_GET['id_conversation']))
  $id_conversation = $_GET['id_conversation'];
else 
  $id_conversation=-1;
  
echo $this->headLink()->appendStylesheet($this->baseUrl() . '/css/layout.css');
?>
<?php echo $this->headLink()->appendStylesheet($this->baseUrl() . '/css/header.css'); ?>
<?php echo $this->headLink()->appendStylesheet($this->baseUrl() . '/css/menu/li-chat.css'); ?>
<?php echo $this->headLink()->appendStylesheet($this->baseUrl() . '/css/chat/chat.css'); ?>

<?php
$this->headScript()->appendFile($this->baseUrl() . '/js/jquery-1.9.1.min.js');
$this->headScript()->appendFile($this->baseUrl() . '/js/chat/contact.js');
$this->headScript()->appendFile($this->baseUrl() . '/js/chat/conversation.js');
$this->headScript()->appendFile($this->baseUrl() . '/js/chat/chat.js');
?>

<div id="view-content">
    <div id="bandeau">
      <img src="<?php echo $this->BaseUrl() . "/images/chat/bandeau_logo.png" ?>" id="bandeau_logo" />
      <div id="liste_bandeau">
        <?php
                //Affichage de l'utilisateur connecté
                if (isset($this->membre)) :
                    foreach ($this->membre as $member) :
                        ?>
                        <strong><?php echo $member['nom']; ?></strong> <?php echo $member['prenom']; ?>
                        <?php
                    endforeach;
                endif;
                ?>
      </div>
    </div>

    <div id="contacts">
      <button id="creer_conversation" onClick="creer_conversation(<?php echo $this->id_user ?>);" >Créer une conversation</button>
      <button id="ajouter_favoris" onClick="ajouter_favoris(<?php echo $this->id_user ?>);" >Ajouter aux favoris</button>
      <hr/><input type="text" name="search" id="search" maxlength=20 placeholder="Rechercher..."/><hr/>
      <span id="select_all">Sélectionner tout </span><input type=checkbox id="select_all_items" /><br/>
      <div id="contacts_liste">
        <div class="wrap">
          <span id="liste_professeur" class="trigger">
            <img src="<?php echo $this->BaseUrl() . "/images/chat/list_close.png" ?>" class="img_list" />
            <img src="<?php echo $this->BaseUrl() . "/images/chat/list_open.png" ?>" class="img_list" hidden /> Enseignants
          </span>
          <input class="check_con" id="check_ens" type=checkbox />
          <div id="select_ens">
            <?php
              //Affichage de la liste des professeurs dans les contacts
              if (isset($this->teacher)) :
                foreach ($this->teacher as $teacher) :
            ?>
                  <div class="item" style="margin-left:10px" name="invites" id="<?php echo $teacher['id_user']; ?>" ><input class="check_item_ens" type=checkbox name="invites" value="<?php echo $teacher['id_user']; ?>"/><small><?php echo $teacher['nom']; ?> <?php echo $teacher['prenom']; ?></small>
                </div>
            <?php
                endforeach;
              endif;
            ?>
          </div>
        </div>
        <div class="wrap">
          <span id="liste_etudiant" class="trigger">
            <img src="<?php echo $this->BaseUrl() . "/images/chat/list_close.png" ?>" class="img_list" />
            <img src="<?php echo $this->BaseUrl() . "/images/chat/list_open.png" ?>" class="img_list" hidden /> Etudiants
          </span>
          <input class="check_con" id="check_etu" type=checkbox /> 
          <div id="select_etu">
            <?php
              //Affichage de la liste des étudiants dans les contacts (par promotion et par groupe)
              if (isset($this->promo)) :
                foreach ($this->promo as $promo) :
            ?>
                  <div class="wrap">
                    <span class="trigger" style="margin-left:10px">
                      <img src="<?php echo $this->BaseUrl() . "/images/chat/list_close.png" ?>" class="img_list" />
                      <img src="<?php echo $this->BaseUrl() . "/images/chat/list_open.png" ?>" class="img_list" hidden />
                      <small> <?php echo $promo['nom']; ?></small>
                    </span>
                    <input class="check_item_etu_an" id="check_etu_an<?php echo $promo['id_promo']; ?>" type=checkbox /> 
                    <div id="promo<?php echo $promo['id_promo']; ?>">
                      <?php
                        if (isset($this->group)) :
                            foreach ($this->group as $group) :
                              if ($promo['id_promo'] == $group['id_promo']) :
                      ?>
                              <div class="wrap">
                                <span class="trigger" style="margin-left:20px">
                                  <img src="<?php echo $this->BaseUrl() . "/images/chat/list_close.png" ?>" class="img_list" />
                                  <img src="<?php echo $this->BaseUrl() . "/images/chat/list_open.png" ?>" class="img_list" hidden />
                                  <small> Groupe <?php echo $group['nom_group']; ?></small>
                                </span>
                                <input class="check_item_etu_gpe<?php echo $promo['id_promo']; ?>" id="check_etu_gpe<?php echo $group['id_group']; ?>" type=checkbox /> 
                                <div id="groupe_<?php echo $group['id_group']; ?>">
                                  <?php
                                    if (isset($this->student)) :
                                      foreach ($this->student as $student):
                                        if (($promo['id_promo'] == $group['id_promo']) && ($student['id_group'] == $group['id_group'])) :
                                  ?> 
                                          <div class="item" name="invites" style="margin-left:30px" id="<?php echo $student['id_student']; ?>"><input class="check_item_etu_etu<?php echo $group['id_group']; ?>" type=checkbox name="invites" value="<?php echo $student['id_user']; ?>"/><small><?php echo $student['nom']; ?> <?php echo $student['prenom']; ?></small>
                                          </div>
                                  <?php
                                        endif;
                                      endforeach;
                                    endif;
                                  ?>
                                </div>
                              </div>
                      <?php 
                            endif;
                          endforeach;
                        endif;
                      ?>
                    </div>
                  </div>
           <?php
               endforeach;
             endif;
           ?>
         </div>
        </div>
        <div class="wrap">
          <span id="liste_professionel" class="trigger">
            <img src="<?php echo $this->BaseUrl() . "/images/chat/list_close.png" ?>" class="img_list" />
            <img src="<?php echo $this->BaseUrl() . "/images/chat/list_open.png" ?>" class="img_list" hidden /> Professionels
          </span>
          <input class="check_con" id="check_pro" type=checkbox />
          <div id="select_pro">
            <?php
              //Affichage de la liste des professionnels dans les contacts
              if (isset($this->pro)) :
                foreach ($this->pro as $pro) :
            ?>
                  <div class="item" style="margin-left:10px" name="invites" id=".<?php echo $pro['id_user']; ?>"><input class="check_item_pro" type=checkbox name="invites" value="<?php echo $pro['id_user']; ?>"/><small><?php echo $pro['nom']; ?> <?php echo $pro['prenom']; ?></small>
                  </div>
            <?php
                endforeach;
              endif;
            ?>
          </div>
        </div>
       <br/><br/><br/><br/><br/><br/>
      </div>
    </div>

    <div id="conversations">
      <div id="favoris_liste" class="wrap">
        <span id="liste_favoris" class="trigger">
          <img src="<?php echo $this->BaseUrl() . "/images/chat/list_close.png" ?>" class="img_list" />
          <img src="<?php echo $this->BaseUrl() . "/images/chat/list_open.png" ?>" class="img_list" hidden /> Favoris
        </span><input class="check_con" id="check_fav" type=checkbox /> 
        <div id="select_fav">
          <?php
            if (isset($this->favoris)) :
              foreach ($this->favoris as $favoris) :
          ?>
                <div class="item" style="margin-left:10px" id="<?php echo $favoris['id_favoris']; ?>"><input class="check_item_fav" type=checkbox name="invites" value="<?php echo $favoris['id_contact']; ?>"/><small><?php echo $favoris['nom']; ?> <?php echo $favoris['prenom']; ?></small>
                </div>
          <?php
              endforeach;
            endif;
          ?>
        </div>
      </div>
      <div id="liste_conversation">
        <?php
          if (isset($this->conversation)) :
            foreach ($this->conversation as $convers) :
        ?>
              <div class='conv' value='<?php echo $convers['id_conversation']; ?>'><small>Conversation <?php echo $convers['id_conversation']; ?></small></div>
        <?php
            endforeach;
          endif;
        ?>
      </div>
      <img src="<?php echo $this->BaseUrl() . "/images/chat/conversation_logo.png" ?>" id="conversation_logo" />
    </div>

    <div id="zone_centre">
      <div id="zone_affichage">
        <?php
          if (isset($this->refresh)) :
            foreach ($this->refresh as $data) :
        ?>
              <p>
                <strong class="msg_left" >
                  <?php echo $data['nom']; ?> <?php echo $data['prenom']; ?>
                </strong> a dit :
                <small class="msg_right" >
                  <i>
                    Le <?php echo $data['date_envoi']; ?>
                  </i>
                </small><br/>
                <dd><?php echo $data['message']; ?></dd>
              </p>
        <?php
            endforeach;
          endif;
        ?>
      </div>
      <div id="zone_saisie">
        <img src="<?php echo $this->BaseUrl() . "/images/chat/saisie_logo.png" ?>" id="saisie_logo" />
        <form action="<?php echo $this->BaseUrl() ."/../application/modules/chat/controllers/submit.php"?>" method="post">
          <p>
            <input type="hidden" name="id_conversation" id="form_conversation" value="<?php echo $id_conversation;?>" />
            <input type="hidden" name="id_source" id="form_source" value="<?php echo $this->id_user; ?>" />
            <textarea name="message" id="form_message"></textarea>
            <input type="submit" value="Envoyer" />
          </p>
        </form>
      </div>
    </div>
</div>