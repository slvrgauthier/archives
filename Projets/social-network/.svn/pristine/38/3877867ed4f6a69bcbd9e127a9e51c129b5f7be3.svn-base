<?php
	session_start();
?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
	<title> RÃ©seau social </title>	
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" xml:lang="fr-FR">
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<script type=text/javascript src="js/jquery-1.9.1.min.js"></script>
	<script type=text/javascript src="js/search_con.js"></script>
</head>
<body>
	<?php include("elements/head.php"); ?>
	<?php include("elements/menu.php"); ?>
	<?php
		try
		{
		    $bdd = new PDO('mysql:host=localhost;dbname=socialnet', 'root', 'root');
		}
		catch (Exception $e)
		{
		        die('Erreur : ' . $e->getMessage());
		}
	?>
	
	<div id="recherche_ami">
		Ajouter un contact <input type=text name="add_con" id="id_add_con" placeholder="Rechercher un contact..." /><br/>
		<?php			
			$search_con_ami=$bdd->query("select * from user, profil where user.id_u=profil.id_user and user.id_u not in (select friend.id_u FROM user as utilisateur, user as friend, ami where utilisateur.id_u=ami.id_u AND friend.id_u=ami.id_ami and utilisateur.id_u=".$_SESSION['id'].") and user.id_u!=".$_SESSION['id']."") or die (print_r($bdd->errorInfo()));
			
			while($datas1 =$search_con_ami->fetch()){
				echo "<div class='users'><img src='/projetWeb/".$datas1['photo_path']."' alt=\"Erreur lors de l'affichage de la photo de profil de ".$datas1['nom_u']." ".$datas1['prenom_u']."\" title='Photo de profil de ".$datas1['nom_u']." ".$datas1['prenom_u']."' width='120px' height='150px' /><br/><img class='img_plus' src='/projetWeb/medias/images/contact_plus.png' /> <span id='user_".$datas1['id_u']."'></span><div class='users_nom' id='users_".$datas1['nom_u']."' />".$datas1['nom_u']."</div> <div class='users_prenom' id='users_".$datas1['prenom_u']."'>".$datas1['prenom_u']."</div></div><br/>";
			}
		?>
	</div>
	
	<div id="affichage_ami">
		<?php			
			$have_friend=false;
			
			$search_ami = $bdd->query('SELECT user1.nom_u AS nom, user1.prenom_u AS prenom, user1.mail_u AS mail_u, user2.nom_u AS nomA, user2.prenom_u AS prenomA, profil.id_user, profil.photo_path FROM user AS user1, user AS user2, ami, profil WHERE user1.id_u=ami.id_u AND user2.id_u=ami.id_ami AND profil.id_user=user2.id_u ') or die (print_r($bdd->errorInfo()));
			
			while($datas = $search_ami->fetch()){
				if($_SESSION['mail']==$datas['mail_u']){
					echo "<div class='amis'><img name='id_img_ami' src='/projetWeb/".$datas['photo_path']."' alt=\"Erreur lors de l'affichage de la photo de profil de ".$datas['nomA']." ".$datas['prenomA']." \" title='Photo de profil de ".$datas['nomA']." ".$datas['prenomA']."' width='120px' height='150px' /><br/>".$datas['nomA']." ".$datas['prenomA']."</div><br/>";
					$have_friend=true;
				}
			}
			if (!$have_friend){
				echo "<div>Vous n'avez pas encore de contact dans votre liste d'amis.</div>";
			}
			echo "</div>";
		?>
	
	</div>
	<?php include("elements/foot.php") ?>
</body>
</html>