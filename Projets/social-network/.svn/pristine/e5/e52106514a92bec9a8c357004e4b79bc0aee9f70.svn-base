<!--
/* 
	* contact.php 
	*
	* Fichier servant a afficher la liste des utilisateurs dans la bdd
	* Inclus dans chat.php
	*
	* @author : LECERF Geoffrey
	* @update : 07-04-13 20:20
	* @last_update_author : LG
*/
 
-->

<?php 
	//CONNEXION A LA BDD
	require_once("connexion_db.php");
	
	/*
		***************************************************************************************************
		**************************	  AFFICHAGE LISTE CONTACTS ENSEIGNANTS      ***************************	
		***************************************************************************************************
	*/	echo '<span id="liste_professeur" class="trigger"><img src="images/list_close.png" class="img_list" /><img src="images/list_open.png" class="img_list" hidden /> Enseignants</span><input class="check_con" id="check_ens" type=checkbox /> <div id="select_ens">'; 
	
	$req_ens = $bdd->query("SELECT * FROM utilisateur WHERE role_user='professeur' ORDER BY nom,prenom");
	
	while ($datas_ens=$req_ens->fetch()){
		echo '<div class="item" style="margin-left:10px" name="invites" id="'.$datas_ens["id_user"].'"><small>'.$datas_ens["nom"].' '.$datas_ens["prenom"].'</small><input class="check_item_ens" type=checkbox name="invites" value="'.$datas_ens["id_user"].'"/></div>';
	}
	echo '</div><br/>';
	
	/*
		***************************************************************************************************
		***************************	   AFFICHAGE LISTE CONTACTS ETUDIANTS      ****************************	
		***************************************************************************************************
	*/
	echo '<span id="liste_etudiant" class="trigger"><img src="images/list_close.png" class="img_list" /><img src="images/list_open.png" class="img_list" hidden /> Etudiants</span><input class="check_con" id="check_etu" type=checkbox /> <div id="select_etu">'; 
	
	//POUR CHAQUE UPLET DE LA TABLE PROMOTION, DONC POUR CHAQUE ANNEE
	$req_etu_an=$bdd->query("SELECT * FROM promotion");
	while($datas_etu_an=$req_etu_an->fetch()){
		//ON AFFICHE L'ANNEE DE LA PROMOTION
		echo '<span class="trigger" style="margin-left:10px"><img src="images/list_close.png" class="img_list" /><img src="images/list_open.png" class="img_list" hidden /><small> '.$datas_etu_an['annee_debut'].' - '.$datas_etu_an['annee_fin'].'</small></span><input class="check_item_etu_an" id="check_etu_an'.$datas_etu_an['id_promo'].'" type=checkbox /> <div id="promo'.$datas_etu_an['id_promo'].'">';
	
		//POUR CHAQUE UPLET DE LA TABLE GROUPE, DONC POUR CHAQUE GROUPE DE CHAQUE PROMO, DONT L'ID_PROMO CORRESPOND A LA PROMO CONSIDEREE
		$req_etu_gpe=$bdd->query("SELECT promotion.id_promo, promotion.nom as nomP, groupe.id_group, groupe.nom as nomG FROM promotion, groupe WHERE promotion.id_promo=groupe.id_promo AND promotion.id_promo='".$datas_etu_an['id_promo']."'");
		while($datas_etu_gpe=$req_etu_gpe->fetch()){
			//ON AFFICHE LE GROUPE
			echo '<span class="trigger" style="margin-left:20px"><img src="images/list_close.png" class="img_list" /><img src="images/list_open.png" class="img_list" hidden /><small> Groupe '.$datas_etu_gpe['nomG'].'</small></span><input class="check_item_etu_gpe'.$datas_etu_an['id_promo'].'" id="check_etu_gpe'.$datas_etu_gpe['id_group'].'" type=checkbox /> <div id="groupe_'.$datas_etu_gpe['id_group'].'">';
			
			//POUR CHAQUE UPLET DE LA TABLE ETUDIANT APPARTENANT AU GROUPE CONSIDE
			$req_etu_etu=$bdd->query("SELECT etudiant.id_student, etudiant.numINE, utilisateur.nom as nomE, utilisateur.prenom as prenomE FROM etudiant, utilisateur, groupe, promotion WHERE etudiant.id_user = utilisateur.id_user AND etudiant.id_group = groupe.id_group AND promotion.id_promo=groupe.id_promo AND groupe.nom = '".$datas_etu_gpe['nomG']."' AND promotion.id_promo='".$datas_etu_an['id_promo']."' ORDER BY utilisateur.nom, utilisateur.prenom");
			while($datas_etu_etu=$req_etu_etu->fetch()){
				//ON AFFICHE L'ETUDIANT DU GROUPE
				echo '<div class="item" name="invites" style="margin-left:30px" id="'.$datas_etu_etu['id_student'].'"><small>'.$datas_etu_etu['nomE'].' '.$datas_etu_etu['prenomE'].'</small><input class="check_item_etu_etu'.$datas_etu_gpe['id_group'].'" type=checkbox name="invites" value="'.$datas_etu_etu['id_student'].'"/></div>';
			}
			echo '</div><br/>';
		}
		echo '</div><br/>';
	}
	echo '</div><br/>';
	
	
	/*
		***************************************************************************************************
		*************************	 AFFICHAGE LISTE CONTACTS PROFESSIONELS      **************************	
		***************************************************************************************************
	*/	echo '<span id="liste_professionel" class="trigger"><img src="images/list_close.png" class="img_list" /><img src="images/list_open.png" class="img_list" hidden /> Professionels</span><input class="check_con" id="check_pro" type=checkbox /> <div id="select_pro">'; 
	$req_pro = $bdd->query("SELECT * FROM utilisateur WHERE role_user='professionnel' ORDER BY nom,prenom");
	
	while ($datas_pro=$req_pro->fetch()){
		echo '<div class="item" style="margin-left:10px" name="invites" id="'.$datas_pro["id_user"].'"><small>'.$datas_pro["nom"].' '.$datas_pro["prenom"].'</small><input class="check_item_pro" type=checkbox name="invites" value="'.$datas_pro["id_user"].'"/></div>';
	}
	echo '</div><br/>';
?>