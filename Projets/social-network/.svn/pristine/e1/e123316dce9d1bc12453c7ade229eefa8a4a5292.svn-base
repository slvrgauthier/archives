<?php
	date_default_timezone_set('Europe/Paris');
	session_start();
?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
	<title> Réseau social </title>	
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" xml:lang="fr-FR">
	<link rel="stylesheet" type="text/css" href="../css/style.css" />
</head>
<body>
	<?php include("../elements/head.php"); ?>
	<?php //include("../elements/menu.php"); ?>
	
	<div id="connect">
		<?php
		try
		{
		    $bdd = new PDO('mysql:host=localhost;dbname=socialnet', 'root', 'root');
		}
		catch (Exception $e)
		{
		        die('Erreur : ' . $e->getMessage());
		}
		
		$req = $bdd->query('SELECT mail_u, mdp_u, nom_u, prenom_u, id_u FROM user') or die(print_r($bdd->errorInfo()));
		$existe_mail=false;
		$existe_mdp=false;
		while ($datas = $req->fetch()){
			if (!(empty($_POST['mail'])) AND !(empty($_POST['passwd']))){
				if($_POST['mail']==$datas['mail_u'] AND $_POST['passwd']!=$datas['mdp_u']){
					$existe_mail=true;
				}
				else if($_POST['mail']==$datas['mail_u'] AND $_POST['passwd']==$datas['mdp_u']){
					$_SESSION['nom']=$datas['nom_u'];
					$_SESSION['prenom']=$datas['prenom_u'];
					$_SESSION['id']=$datas['id_u'];
					$_SESSION['mail']=$datas['mail_u'];
					$existe_mail=true;
					$existe_mdp=true;
				}
			}
		}
		
		if(!$existe_mail){
			echo "<br/>";
			if(strlen($_POST['mail'])==0){
				echo "Veuillez entrez une adresse mail pour vous connecter.";
			}
			else
				echo $_POST['mail']." n'est pas inscrit au site.";
			
			?><br/><a href="../index/index.php"> Retour à l'accueil </a>
			<?php
		}
		else if(!$existe_mdp){
			echo "Mot de passe incorrect pour ".$_POST['mail'].".";
			?><br/><br/><a href="../index/index.php"> Retour à l'accueil </a>
			<?php			
		}
		else{
			header("Location: ../index/index.php");
		}	
		?>
	</div>
	
	<?php include("../elements/foot.php") ?>
</body>
</html>